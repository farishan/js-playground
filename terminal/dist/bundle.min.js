(()=>{function l(n={debug:!1,onSubmit:()=>{}}){if(!document){console.error("Cannot find HTML document.");return}let t=this;this.DOM_map={root:document.createElement("form"),input:document.createElement("input")},this.init=function(){let{root:i,input:e}=t.DOM_map;e.name="input",e.placeholder="type something...",i.autocomplete="off",i.onsubmit=r=>{r.preventDefault();let{value:s}=e;if(n.debug){let a=document.createElement("p");a.innerHTML=s,i.appendChild(a)}n.onSubmit(s.toLowerCase(),t.resetInput)}},this.focusInput=function(){t.DOM_map.input.isConnected&&t.DOM_map.input.focus()},this.addInputListener=function(i,e){t.DOM_map.input[i]=e},this.resetInput=function(){t.DOM_map.input.value=""},this.setInputValue=function(i){t.DOM_map.input.value=i},this.finalize=function(){t.DOM_map.root.appendChild(t.DOM_map.input)},this.getRoot=function(){return t.DOM_map.root},this.moveInputCursorToTheEnd=function(){let{input:i}=t.DOM_map;setTimeout(()=>i.selectionStart=i.selectionEnd=1e4,0)}}var u=l;function m(n={}){let t=this;this.limit=n.limit||100,this.data=[],this.push=function(i){t.data.length>t.limit-1&&t.data.shift(),t.data.push(i)}}var p=m;function c(n={}){let t=this,i=100;this.pointer=0,this.limit=n.limit||i,this.items=new p,this.add=this.items.push,this.resetPointer=function(){t.pointer=0},this.navigate=function(e){e==="prev"?t.pointer*-1<t.items.data.length&&t.pointer--:e==="next"&&t.pointer<0&&t.pointer++},this.getPointedValue=function(){return t.pointer===0?"":t.items.data[t.items.data.length+t.pointer]}}var h=c;function o(n,t={debug:!1,historyLimit:100}){if(!document){console.error("Cannot find HTML document.");return}if(this.$root=n||document.body,!this.$root||this.$root&&!this.$root.appendChild){console.error("Invalid root for Terminal.");return}this.debug=t.debug,this.initialized=!1,this.lastInput=null,this.currentInput=null,this.onChange=null,this.listenerMap={};let i={debug:!0,onSubmit:(...e)=>this.handleInput(...e)};this.GUI_manager=new u(i),this.historyManager=new h}o.prototype.addListener=function(n,t){if(!n||!t){console.error("Invalid props for Terminal.addListener");return}this.listenerMap[n]=t};o.prototype.emit=function(n){this.onChange!==null&&typeof this.onChange=="function"&&this.onChange(n);let t=Object.keys(this.listenerMap);t.length>0&&t.forEach(i=>{this.listenerMap[i](n)})};o.prototype.handleInput=function(n,t){this.lastInput!==this.currentInput&&(this.lastInput=this.currentInput),this.currentInput!==n&&(this.currentInput=n),this.historyManager.add(n);let i=n.split(" ")[0],e=n.split(" ")[1],r=n.split(" ")[2];this.emit([i,e,r]),this.historyManager.resetPointer(),t()};o.prototype.finalize=function(){this.GUI_manager.focusInput()};o.prototype.init=function(){let n=this;this.GUI_manager.init(function(...i){n.handleInput(...i)});function t(i){i.key!=="ArrowUp"&&i.key!=="ArrowDown"||(i.key==="ArrowUp"?n.historyManager.navigate("prev"):i.key==="ArrowDown"&&n.historyManager.navigate("next"),n.GUI_manager.setInputValue(n.historyManager.getPointedValue()),n.GUI_manager.moveInputCursorToTheEnd())}this.GUI_manager.addInputListener("onkeydown",t),this.GUI_manager.finalize(),this.$root.appendChild(this.GUI_manager.getRoot()),this.finalize(),this.initialized=!0};var f=o;var w=f;})();
